<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greenhi.peachland.mapper.DynamicMapper">


    <resultMap id="dynamicMap" type="com.greenhi.peachland.item.ItemFocusDynamic">
        <id column="id" property="id"/>
        <result column="uid" property="uid"/>
        <result column="user_name" property="userName"/>
        <result column="dynamic_content" property="dynamicContent"/>
        <result column="img_count" property="imgCount"/>
        <result column="love_number" property="loveNumber"/>
        <result column="comment_number" property="commentNumber"/>
        <result column="create_time" property="createTime"/>
    </resultMap>

    <select id="selectFocusByUidPaging" resultMap="dynamicMap">
        select * from (
            select d.id,d.uid,v.user_name,dynamic_content,img_count,love_number,comment_number,d.create_time
            from user u
            inner join focus f on u.id=f.uid
            inner join user v on f.fid=v.id
            inner join dynamic_ d on f.fid=d.uid
            where u.id=#{uid}
            order by d.id desc
        ) as add_
        LIMIT #{index},#{pageSize}
    </select>

    <select id="selectByUid" resultMap="dynamicMap">
        select d.id,d.uid,u.user_name,dynamic_content,img_count,love_number,comment_number,d.create_time
        from user u
        inner join dynamic_ d on u.id=d.uid
        where u.id=#{uid}
        order by d.id desc
    </select>

    <update id="addLikeById">
        update dynamic_
        set love_number=love_number+1
        where id=#{id}
    </update>

    <update id="addCommById">
        update dynamic_
        set comment_number=comment_number+1
        where id=#{id}
    </update>

    <update id="subLikeById">
        update dynamic_
        set love_number=love_number-1
        where id=#{id}
    </update>

    <update id="subCommById">
        update dynamic_
        set comment_number=comment_number-1
        where id=#{id}
    </update>

    <update id="setImgCount">
        update dynamic_
        set img_count=#{count}
        where id=#{id}
    </update>

    <select id="selectPaging" resultMap="dynamicMap">

        select d.id,d.uid,u.user_name,dynamic_content,img_count,love_number,comment_number,d.create_time
        from (
	        SELECT * FROM (
	            select * from dynamic_ order by id desc
	        )as add_
	       LIMIT #{index},#{pageSize}
        ) as d INNER JOIN user u
        on u.id=d.uid
    </select>

</mapper>
